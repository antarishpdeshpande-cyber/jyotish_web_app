name: ğŸš€ Build & Deploy Flutter Web (to /docs)

on:
  push:
    branches:
      - main   # Deploy only when code is pushed or merged to main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout your repository code
      - name: ğŸ§© Checkout repository
        uses: actions/checkout@v4

      # Step 2: Setup Flutter
      - name: ğŸ§° Setup Flutter SDK
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.22.0"
          channel: stable

      # Step 3: Fetch dependencies
      - name: ğŸ“¦ Install dependencies
        run: flutter pub get

      # Step 4: Build the Flutter Web app
      - name: ğŸ—ï¸ Build web app
        run: flutter build web --release --base-href /${{ github.event.repository.name }}/

      # Step 5: Replace docs folder with the new build
      - name: ğŸ§¹ Clean & copy build to /docs
        run: |
          rm -rf docs
          mkdir docs
          cp -r build/web/* docs/

      # Step 6: Commit & push updated /docs folder
      - name: ğŸš€ Commit & push to main
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add docs
          git commit -m "ğŸ¤– Auto deploy: $(date +'%Y-%m-%d %H:%M:%S')"
          git push origin main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
